<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/spinner-backdrop/spinner-backdrop.html">
<link rel="import" href="confirm-delete-dialog.html">
<link rel="import" href="message-controls.html">
<link rel="import" href="message-details.html">
<link rel="import" href="message-list-behavior.html">
<link rel="import" href="message-list-item.html">

<dom-module id="message-outbox">
  <template>
    <style>

      :host {
        height: 100%;
        display: flex; 
      }

      .no-messages {
        display: flex;
        width: 100%;
        justify-content: center;
        align-items: center;
      }
      
      .no-messages > paper-material {
        text-align: center;
        margin-bottom: 100px;
        padding: 60px;
        width: 400px;
        background: white;
      }

    </style>
    <confirm-delete-dialog 
      id                      = "confirm-delete-dialog" 
      on-delete-confirmed     = "_deleteSelection"
      selection-size          = "[[selectionSize]]">
    </confirm-delete-dialog>
    <message-details 
      id                      = "details"
      on-delete-item          = "_deleteMessage"
      on-next                 = "showNextMessage"
      on-prev                 = "showPreviousMessage">
    </message-details>
    <div
      class                   = "no-messages"
      hidden$                 = "[[!isEmpty]]">
      <paper-material>
        There are no messages here.
      </paper-material>
    </div>
    <iron-list
      id                      = "list"
      as                      = "item"
      selected-items          = "{{selection}}"
      on-scroll               = "onScroll"
      items                   = "[[messages]]"
      max-physical-count      = "1000"
      multi-selection>
      <template>
        <message-list-item
          on-tap              = "onTap"
          on-selected-toggled = "onSelectedToggled"
          on-show-details     = "onShowDetails"
          select-mode         = "[[hasSelection]]"
          selected            = "[[selected]]"
          item                = "[[item]]"
          outgoing>
        </message-list-item>
      </template>
    </iron-list>
    <message-controls
      id                      = "controls"
      on-iron-resize          = "onResize"
      on-select-all           = "onSelectAll"
      on-unselect-all         = "onUnselectAll"
      on-delete-selection     = "onDeleteSelection"
      has-selection           = "[[hasSelection]]"
      selection-size          = "[[selectionSize]]"
      outgoing>
    </message-controls>
  </template>
  <script>

    Polymer({

      is: 'message-outbox',

      properties: {
      },

      behaviors: [
        MessageListBehavior,
      ],

      onScroll: function() {
      },

      onTap: function(e) {
        if (this.hasSelection && ['checkboxContainer', 'icon'].indexOf(e.target.id) == -1) {
          var list = this._getList();
          e.model.selected ? list.deselectItem(e.model.index) 
                           : list.selectItem(e.model.index);
        }
      },

      _getList: function() {
        return this.$.list;
      },

    });

  </script>
</dom-module>
